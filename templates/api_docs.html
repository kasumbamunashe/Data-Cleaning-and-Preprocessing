{% extends "base.html" %}

{% block content %}
<div class="row">
    <div class="col-lg-10 mx-auto">
        <div class="card shadow-sm mb-4">
            <div class="card-header gradient-bg text-white">
                <h4 class="mb-0"><i class="bi bi-code-square me-2"></i>API Documentation</h4>
            </div>
            <div class="card-body">
                <div class="alert alert-info">
                    <i class="bi bi-info-circle me-2"></i>
                    <strong>Base URL:</strong> {{ request.url_root }}api
                </div>

                <div class="mb-5">
                    <h5 class="border-bottom pb-2 mb-3"><i class="bi bi-key-fill text-warning me-2"></i>Authentication</h5>
                    <p>All API requests require an API key in the <code>X-API-KEY</code> header.</p>
                    <div class="card bg-dark text-light">
                        <div class="card-body">
                            <pre class="mb-0"><code>curl -X POST \
  -H "X-API-KEY: your_api_key_here" \
  -F "file=@data.csv" \
  "{{ request.url_root }}api/clean"</code></pre>
                        </div>
                    </div>
                </div>

                <div class="mb-5">
                    <h5 class="border-bottom pb-2 mb-3"><i class="bi bi-upload text-primary me-2"></i>Clean Data Endpoint</h5>
                    
                    <div class="mb-4">
                        <h6><span class="badge bg-primary me-2">POST</span> /clean</h6>
                        <p>Process and clean uploaded data file.</p>
                        
                        <div class="card mb-3">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Request Parameters</h6>
                            </div>
                            <div class="card-body">
                                <div class="table-responsive">
                                    <table class="table table-sm">
                                        <thead>
                                            <tr>
                                                <th>Parameter</th>
                                                <th>Type</th>
                                                <th>Required</th>
                                                <th>Description</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td><code>file</code></td>
                                                <td>File</td>
                                                <td>Yes</td>
                                                <td>Data file to process (CSV, Excel, or JSON)</td>
                                            </tr>
                                            <tr>
                                                <td><code>impute_strategy</code></td>
                                                <td>String</td>
                                                <td>No</td>
                                                <td>Missing value strategy (smart|knn|mean|mode|drop, default: smart)</td>
                                            </tr>
                                            <tr>
                                                <td><code>output_format</code></td>
                                                <td>String</td>
                                                <td>No</td>
                                                <td>Output format (csv|excel|json, default: csv)</td>
                                            </tr>
                                            <tr>
                                                <td><code>contamination</code></td>
                                                <td>Float</td>
                                                <td>No</td>
                                                <td>Outlier sensitivity (0.01-0.5, default: 0.05)</td>
                                            </tr>
                                            <tr>
                                                <td><code>scaling</code></td>
                                                <td>String</td>
                                                <td>No</td>
                                                <td>Numerical scaling method (standard|minmax|none, default: standard)</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <div class="card">
                            <div class="card-header bg-light">
                                <h6 class="mb-0">Response Examples</h6>
                            </div>
                            <div class="card-body">
                                <h6 class="mt-3">Success Response (200 OK)</h6>
                                <div class="card bg-dark text-light mb-3">
                                    <div class="card-body">
                                        <pre class="mb-0"><code>{
  "status": "success",
  "filename": "cleaned_data_20230501_142356.csv",
  "stats": {
    "original_rows": 1000,
    "rows_after_cleaning": 950,
    "outliers_removed": 50,
    "missing_values_imputed": 120
  }
}</code></pre>
                                    </div>
                                </div>
                                
                                <h6 class="mt-3">Async Response (202 Accepted)</h6>
                                <div class="card bg-dark text-light mb-3">
                                    <div class="card-body">
                                        <pre class="mb-0"><code>{
  "status": "processing",
  "task_id": "550e8400-e29b-41d4-a716-446655440000",
  "message": "Large file processing started"
}</code></pre>
                                    </div>
                                </div>
                                
                                <h6 class="mt-3">Error Response (400 Bad Request)</h6>
                                <div class="card bg-dark text-light">
                                    <div class="card-body">
                                        <pre class="mb-0"><code>{
  "error": "No file provided",
  "status": "failed"
}</code></pre>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-4">
                    <h5 class="border-bottom pb-2 mb-3"><i class="bi bi-hourglass-split text-info me-2"></i>Task Status Endpoint</h5>
                    
                    <div class="mb-3">
                        <h6><span class="badge bg-primary me-2">GET</span> /tasks/&lt;task_id&gt;</h6>
                        <p>Check status of an asynchronous processing task.</p>
                    </div>
                    
                    <div class="card bg-dark text-light">
                        <div class="card-body">
                            <pre class="mb-0"><code>{
  "state": "PROGRESS",
  "status": "Processing data...",
  "progress": 65
}</code></pre>
                        </div>
                    </div>
                </div>
            </div>
            <div class="card-footer text-center">
                <a href="{{ url_for('index') }}" class="btn btn-outline-primary">
                    <i class="bi bi-arrow-left me-2"></i>Back to Home
                </a>
            </div>
        </div>
    </div>
</div>
{% endblock %}